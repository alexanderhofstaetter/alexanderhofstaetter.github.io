<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.1">
    <meta name="project" content="PVE v0.0.1">


    <title>Owat.Support.Presence â€” PVE v0.0.1</title>
    <link rel="stylesheet" href="dist/html-elixir-VEFCVPF3.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-FE64E7E5.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-7XSQ4GTY.js"></script>

  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
PVE
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.0.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of PVE</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

    <span translate="no">Owat.Support.Presence</span> 
    <small class="app-vsn" translate="no">(PVE v0.0.1)</small>

  </h1>


    <section id="moduledoc">
<p>A module to manage presence state.</p><p>This module contains the actionable portion of presence functionality. It
must be used with a state-carrying facility, such as a <a href="https://hexdocs.pm/elixir/GenServer.html"><code class="inline">GenServer</code></a>.</p><h2 id="module-method" class="section-heading">
  <a href="#module-method" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Method</span>
</h2>
<p>This module has functions to track resources in a presence channel. It only
tracks the IDs. When an ID is added, removed or changed it will invoke a
fetcher function to obtain the payload to be sent to the client.</p><h2 id="module-usage" class="section-heading">
  <a href="#module-usage" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Usage</span>
</h2>
<p>To use the functions in this module a state value has to be generated. To
generate this value you have to supply the channel name and fetcher function.
Optionally initial data may be passed to init.</p><pre><code class="makeup elixir" translate="no"><span class="nc">Owat.Support.Presence</span><span class="o">.</span><span class="n">init</span><span class="p" data-group-id="2535411490-1">(</span><span class="s">&quot;channel_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fetch</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2535411490-1">)</span><span class="w">
</span><span class="c1"># or</span><span class="w">
</span><span class="nc">Owat.Support.Presence</span><span class="o">.</span><span class="n">init</span><span class="p" data-group-id="2535411490-2">(</span><span class="s">&quot;channel_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fetch</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2535411490-3">[</span><span class="p" data-group-id="2535411490-3">]</span><span class="p" data-group-id="2535411490-2">)</span></code></pre><p>To update the state use <a href="#put/2"><code class="inline">put/2</code></a> and <a href="#delete/2"><code class="inline">delete/2</code></a>.</p><h3 id="module-local-mode" class="section-heading">
  <a href="#module-local-mode" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Local mode</span>
</h3>
<p>This module broadcasts the diff-updates on the given channel or only on a
specific socket, previously called local-mode.
To enable local mode, pass the socket instead of a channel name to the
<a href="#init/3"><code class="inline">init/3</code></a> function.</p><pre><code class="makeup elixir" translate="no"><span class="nc">Owat.Support.Presence</span><span class="o">.</span><span class="n">init</span><span class="p" data-group-id="3604095861-1">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fetch</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3604095861-2">[</span><span class="p" data-group-id="3604095861-2">]</span><span class="p" data-group-id="3604095861-1">)</span></code></pre><p>The init function itself does not send data to the client.</p><h2 id="module-fetcher-function" class="section-heading">
  <a href="#module-fetcher-function" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Fetcher Function</span>
</h2>
<p>The fetcher function must produce the payload objects to send to the client.
It is given a list of IDs and returns a map of payload objects that are keyed
with their respective IDs. Returning an enumerable that can be directly
converted to this map is also acceptable.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:data/0" data-no-tooltip translate="no">data()</a>

      </div>

        <div class="summary-synopsis"><p>Data to be tracked in the presence state.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:fetcher/0" data-no-tooltip translate="no">fetcher()</a>

      </div>

        <div class="summary-synopsis"><p>A function that takes a list of IDs and produces a map of <code class="inline">%{id =&gt; data}</code>
where <code class="inline">data</code> is the payload to be sent to the clients.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:state/0" data-no-tooltip translate="no">state()</a>

      </div>

        <div class="summary-synopsis"><p>The current presence state.</p></div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete/2" data-no-tooltip translate="no">delete(arg, obj)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes an object or list of objects from the state if present.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#init/3" data-no-tooltip translate="no">init(channel_name_or_socket, fetcher, initial_data \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Produces an empty presence state.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#keys/1" data-no-tooltip translate="no">keys(arg)</a>

      </div>

        <div class="summary-synopsis"><p>Obtains the IDs of the resources currently present.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#push/2" data-no-tooltip translate="no">push(arg, socket)</a>

      </div>

        <div class="summary-synopsis"><p>Pushes the presence state to a socket.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put/2" data-no-tooltip translate="no">put(arg, obj)</a>

      </div>

        <div class="summary-synopsis"><p>Adds an object or list of objects to the state, replacing any previous entry with the same id.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put_direct/3" data-no-tooltip translate="no">put_direct(arg, id, obj)</a>

      </div>

        <div class="summary-synopsis"><p>Adds an object or list of objects to the state, replacing any previous entry
with the same id.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reset/2" data-no-tooltip translate="no">reset(arg, list)</a>

      </div>

        <div class="summary-synopsis"><p>Resets the state to contain only the given elements.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#reset_direct/2" data-no-tooltip translate="no">reset_direct(arg, list)</a>

      </div>

        <div class="summary-synopsis"><p>Resets the state to contain only the given elements.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Types</span>
    </h1>
    <div class="types-list">
<section class="detail" id="t:data/0">

  <div class="detail-header">
    <a href="#t:data/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">data()</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> data() :: %{id: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()} | <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()</pre>

      </div>

<p>Data to be tracked in the presence state.</p><p>Any object tracked in the presence state must have a unique ID and this ID
must be in the <code class="inline">:id</code> field of the map. The presence state only tracks the
contained IDs. An ID is transformed be the fetcher function to the payload to
be transmitted. Any function receiving data information may also only receive
the ID of the object to be tracked.</p>
  </section>
</section>
<section class="detail" id="t:fetcher/0">

  <div class="detail-header">
    <a href="#t:fetcher/0" class="detail-link" data-no-tooltip title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">fetcher()</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@type</span> fetcher() :: ([<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()] -&gt; %{required(<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()) =&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()})</pre>

      </div>

<p>A function that takes a list of IDs and produces a map of <code class="inline">%{id =&gt; data}</code>
where <code class="inline">data</code> is the payload to be sent to the clients.</p>
  </section>
</section>
<section class="detail" id="t:state/0">

  <div class="detail-header">
    <a href="#t:state/0" class="detail-link" data-no-tooltip title="Link to this opaque">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this opaque</span>
    </a>
    <h1 class="signature" translate="no">state()</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@opaque</span> state()</pre>

      </div>

<p>The current presence state.</p><p>An instance of this type contains all necessary information to perform
actions with this module. The state data is meant to be kept in a
state-carrying facility such as a <a href="https://hexdocs.pm/elixir/GenServer.html"><code class="inline">GenServer</code></a>.</p><p>All functions (except <a href="#init/3"><code class="inline">init/3</code></a> of course) take the state parameter as
first argument. Modifying functions return the new state. The state shall not
be modified by other means than this module.</p>
  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="delete/2">

  <div class="detail-header">
    <a href="#delete/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete(arg, obj)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> delete(<a href="#t:state/0">state</a>(), <a href="#t:data/0">data</a>() | [<a href="#t:data/0">data</a>()]) :: <a href="#t:state/0">state</a>()</pre>

      </div>

<p>Deletes an object or list of objects from the state if present.</p>
  </section>
</section>
<section class="detail" id="init/3">

    <span id="init/2"></span>

  <div class="detail-header">
    <a href="#init/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">init(channel_name_or_socket, fetcher, initial_data \\ [])</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> init(<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>() | <a href="https://hexdocs.pm/phoenix/1.7.14/Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>(), <a href="#t:fetcher/0">fetcher</a>(), [<a href="#t:data/0">data</a>()]) :: <a href="#t:state/0">state</a>()</pre>

      </div>

<p>Produces an empty presence state.</p><p>The first parameter may either be a channel name, where all updates are
broadcasted to or a socket when the presence state is local to a single
socket (local mode).</p><p>The second parameter is the fetcher function. Since the state only tracks the
IDs of the objects, the fetcher function is necessary to fetch the payload
data to be sent to the clients on change.</p><p>Optionally the initial data may be supplied as third argument.</p><p>This function does not send data to clients.</p>
  </section>
</section>
<section class="detail" id="keys/1">

  <div class="detail-header">
    <a href="#keys/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">keys(arg)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> keys(<a href="#t:state/0">state</a>()) :: [<a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>()]</pre>

      </div>

<p>Obtains the IDs of the resources currently present.</p>
  </section>
</section>
<section class="detail" id="push/2">

  <div class="detail-header">
    <a href="#push/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">push(arg, socket)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> push(<a href="#t:state/0">state</a>(), <a href="https://hexdocs.pm/phoenix/1.7.14/Phoenix.Socket.html#t:t/0">Phoenix.Socket.t</a>()) :: :ok</pre>

      </div>

<p>Pushes the presence state to a socket.</p>
  </section>
</section>
<section class="detail" id="put/2">

  <div class="detail-header">
    <a href="#put/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">put(arg, obj)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> put(<a href="#t:state/0">state</a>(), <a href="#t:data/0">data</a>() | [<a href="#t:data/0">data</a>()]) :: <a href="#t:state/0">state</a>()</pre>

      </div>

<p>Adds an object or list of objects to the state, replacing any previous entry with the same id.</p>
  </section>
</section>
<section class="detail" id="put_direct/3">

  <div class="detail-header">
    <a href="#put_direct/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">put_direct(arg, id, obj)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> put_direct(<a href="#t:state/0">state</a>(), <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()) :: <a href="#t:state/0">state</a>()</pre>

      </div>

<p>Adds an object or list of objects to the state, replacing any previous entry
with the same id.</p><p>This function, in contrast to <a href="#put/2"><code class="inline">put/2</code></a> does not invoke the fetcher and does
therefore require to have already the prepared datamap passed.</p>
  </section>
</section>
<section class="detail" id="reset/2">

  <div class="detail-header">
    <a href="#reset/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reset(arg, list)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> reset(<a href="#t:state/0">state</a>(), [<a href="#t:data/0">data</a>()]) :: <a href="#t:state/0">state</a>()</pre>

      </div>

<p>Resets the state to contain only the given elements.</p><blockquote><h4 class="warning">Beware</h4><p>This action will not send updates for any elements that were previously in
the state. It will only join elements not present in the current state and
leave elements not present in the argument.</p></blockquote>
  </section>
</section>
<section class="detail" id="reset_direct/2">

  <div class="detail-header">
    <a href="#reset_direct/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reset_direct(arg, list)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> reset_direct(<a href="#t:state/0">state</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>()) :: <a href="#t:state/0">state</a>()</pre>

      </div>

<p>Resets the state to contain only the given elements.</p><p>In contrast to <a href="#reset/2"><code class="inline">reset/2</code></a>, this function does not invoke the fetcher and
rejoins all elements regardless of the previous state.
This function expects already prepared datamaps to be passed.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="PVE.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.1) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
